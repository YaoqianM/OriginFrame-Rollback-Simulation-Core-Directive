spring:
  datasource:
    url: jdbc:mysql://localhost:3306/lineage_sim
    username: lineage
    password: changeme
    driver-class-name: com.mysql.cj.jdbc.Driver
  jpa:
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQLDialect
    open-in-view: false
  kafka:
    bootstrap-servers: localhost:9092
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
      properties:
        spring.json.add.type.headers: false
    consumer:
      group-id: lineage-sim
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: prototype.simulationcore.domain,prototype.lineageruntime.health,prototype.lineageruntime.resilience,prototype.lineageruntime.recovery,prototype.simulationcore.events
        spring.json.value.default.type: prototype.simulationcore.domain.LineageEvent

health:
  monitor:
    window-duration: PT5M
    aggregate-interval: 5000

runtime:
  checkpointing:
    retention-days: 7
    retention-sweep-interval: PT1H
    critical:
      operation-interval: 5
      services:
        - simulation-core
    non-critical:
      interval: PT10M
      poll-interval: PT1M
      services: []

resilience:
  circuit-breaker:
    failure-threshold: 5
    reset-timeout: PT30S
    half-open-max-calls: 3
    services:
      simulation-service:
        failure-threshold: 4
        reset-timeout: PT20S
        half-open-max-calls: 2
  service-graph:
    services:
      simulation-service:
        dependencies: []
      simulation-controller:
        dependencies:
          - simulation-service
      rollback-service:
        dependencies:
          - simulation-service
      health-monitor:
        dependencies:
          - simulation-service

recovery:
  services:
    - id: ingestion-service
      version: "1.2.0"
      dependencies:
        - storage-service
        - analytics-service
      fallback: ingestion-canary
    - id: storage-service
      version: "2.4.1"
      dependencies:
        - telemetry-service
    - id: telemetry-service
      version: "0.9.5"
      dependencies: []
    - id: grid-control-plane
      version: "3.1.0"
      dependencies:
        - grid-switch-a
        - grid-switch-b
    - id: grid-switch-a
      version: "3.1.0"
      dependencies:
        - grid-storage-array
    - id: grid-switch-b
      version: "3.1.0"
      dependencies:
        - grid-storage-array
      fallback: grid-switch-b-canary
    - id: grid-storage-array
      version: "2.0.1"
      dependencies:
        - grid-edge-gateway
    - id: grid-edge-gateway
      version: "1.4.2"
      dependencies: []
  backoff:
    initial: PT1S
    max: PT30S
    attempts: 5
  health:
    max-staleness: PT20S

integration:
  demo:
    grid:
      agents: 10
      target-ticks: 200
      failure-tick: 100
      failure-node-id: grid-switch-b
      nodes:
        - node-id: grid-control
          name: Control Plane
          service-id: grid-control-plane
        - node-id: grid-switch-a
          name: Switch Segment A
          service-id: grid-switch-a
        - node-id: grid-switch-b
          name: Switch Segment B
          service-id: grid-switch-b
        - node-id: grid-storage
          name: Storage Array
          service-id: grid-storage-array
        - node-id: grid-edge
          name: Edge Gateway
          service-id: grid-edge-gateway

springdoc:
  api-docs:
    path: /v3/api-docs
  swagger-ui:
    path: /swagger-ui.html
    tags-sorter: alpha
    operations-sorter: method
    try-it-out-enabled: true

simulation:
  world:
    grid:
      width: 64
      height: 64
      topology: GRID
    initial-agent-count: 5
    resource-distribution:
      density: 0.2
      min-quantity: 5
      max-quantity: 25
      regeneration-rate: 0.5
      default-resource-type: ENERGY
    physics:
      tick-interval: PT1S
      friction: 0.05
      gravity: 9.81
      energy-decay: 0.01
  events:
    topic: simulation-events

safety:
  boundary:
    min-x: -250
    max-x: 250
    min-y: -250
    max-y: 250
    min-z: -25
    max-z: 25
    severity: CRITICAL
  resource:
    min-energy: 5
    min-resources: 0
    severity: VIOLATION
    minimum-energy-for-action:
      REPLICATE: 40
      MOVE: 5
    minimum-resources-for-action:
      REPLICATE: 80
  interaction:
    required-signal-key: neighbors
    min-signal-value: 1.0
    minimum-generation: 1
    severity: VIOLATION
  rate:
    limits:
      - action: MOVE
        max-attempts: 10
        window: PT5S
        severity: WARNING
      - action: INTERACT
        max-attempts: 3
        window: PT15S
        severity: VIOLATION
  custom-rules:
    - id: energy-floor
      severity: VIOLATION
      rule: '{"metric":"energy","operator":">=","threshold":10}'
    - id: toxicity-cap
      severity: CRITICAL
      rule: '{"metric":"sensor.toxicity","operator":"<","threshold":75}'
  elimination-threshold: 3
